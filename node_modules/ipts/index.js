const r2 = require('r2')

module.exports = {

  set: async function(tag, hash) {
    const json = { hash }
    const res = await r2.put(`http://tiny-tagging-service.herokuapp.com/tags/${tag}`, { json }).response
    if (res.status > 399) {
      throw new Error(res.statusText)
    }
    return null
  },

  get: async function(tag) {
    const headers = { "Accept": "application/json" }
    const res = await r2(`http://tiny-tagging-service.herokuapp.com/tags/${tag}`, { headers }).response
    if (res.status === 404) return null
    if (res.status > 499) {
      throw new Error(res.statusText)
    }
    return res.json()
  },

  remove: async function(tag) {
    const res = await r2.delete(`http://tiny-tagging-service.herokuapp.com/tags/${tag}`).response
    if (res.status > 399) {
      throw new Error(res.statusText)
    }
    return null
  },

}
